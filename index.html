<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>JS Drum Machine</title>
        <link rel="stylesheet" href="style.css" />
        <!-- fonts -->
        <!-- <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Oxanium:wght@700&display=swap"
            rel="stylesheet"
        /> -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Oxanium:wght@200;600;700;800&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="./mega-walkthrough/mega-walkthrough.css" />
    </head>
    <body>
        <div class="mega-drum-machine">
            <header>
                <span class="title">BeatMachine</span>by
                <span class="signature">megaDoug</span>
            </header>
            <main>
                <div id="help-icon" data-mega-step="0">?</div>
                <div id="drumpad">
                    <div id="sliders">
                        <div class="slidecontainer" data-mega-step="7">
                            <div class="info tempo">
                                <label for="tempo-slider">TEMPO</label>
                                <span class="value">125</span>
                            </div>
                            <input
                                id="tempo-slider"
                                type="range"
                                min="50"
                                max="200"
                                value="125"
                                class="slider"
                            />
                        </div>
                        <div class="slidecontainer" data-mega-step="8">
                            <div class="info measure">
                                <label for="measures-slider">MEASURES</label>
                                <span class="value">2</span>
                            </div>

                            <input
                                id="measures-slider"
                                type="range"
                                min="1"
                                max="4"
                                value="2"
                                class="slider"
                            />
                        </div>
                    </div>
                    <div id="lights">
                        <div
                            id="beat-light"
                            class="light"
                            data-mega-step="2"
                        ></div>
                        <div id="rec-light" class="light" data-mega-step="3">
                            R
                        </div>
                        <div id="clear-light" class="light" data-mega-step="4">
                            X
                        </div>
                        <div
                            id="quantize-light"
                            class="light"
                            data-mega-step="5"
                        >
                            Q
                        </div>
                        <div
                            id="edit-light"
                            class="light rect"
                            data-mega-step="6"
                        >
                            Edit
                        </div>
                    </div>

                    <div id="keys" data-mega-step="1">
                        <div class="key" data-key="65">
                            <kbd>A</kbd>
                            <span class="sound">clap</span>
                        </div>
                        <div class="key" data-key="83">
                            <kbd>S</kbd>
                            <span class="sound">hihat</span>
                        </div>
                        <div class="key" data-key="68">
                            <kbd>D</kbd>
                            <span class="sound">kick</span>
                        </div>
                        <div class="key" data-key="70">
                            <kbd>F</kbd>
                            <span class="sound">openhat</span>
                        </div>
                        <div class="key" data-key="71">
                            <kbd>G</kbd>
                            <span class="sound">boom</span>
                        </div>
                        <div class="key" data-key="72">
                            <kbd>H</kbd>
                            <span class="sound">ride</span>
                        </div>
                        <div class="key" data-key="74">
                            <kbd>J</kbd>
                            <span class="sound">snare</span>
                        </div>
                        <div class="key" data-key="75">
                            <kbd>K</kbd>
                            <span class="sound">tom</span>
                        </div>
                        <div class="key" data-key="76">
                            <kbd>L</kbd>
                            <span class="sound">tink</span>
                        </div>
                        <div class="key" data-key="186">
                            <kbd>;</kbd>
                            <span class="sound">cowbell</span>
                        </div>
                        <div class="key" data-key="222">
                            <kbd>'</kbd>
                            <span class="sound">cb muted</span>
                        </div>
                    </div>
                </div>
                <div id="track-tools">
                    <div id="code-controls">
                        <button id="get-code-button" data-mega-step="10">
                            Get Code
                        </button>
                        <fieldset
                            style="display: inline; border: none"
                            data-mega-step="11"
                        >
                            <input
                                type="text"
                                name="code"
                                id="code-input"
                            /><button id="enter-code-button">Enter Code</button>
                        </fieldset>
                    </div>
                    <div id="edit-buttons">
                        <button id="copy-notes" class="edit-button on">C</button>
                        <button id="paste-notes" class="edit-button">V</button>
                    </div>
                    <div><div id="counter">&nbsp;</div></div>
                    <div>
                        <select name="presets" id="presets">
                            <option value="">Select a Preset</option>
                            <option value="song-1">Beat 1</option>
                            <option value="song-2">Beat 2</option>
                            <option value="song-3">Beat 3</option>
                        </select>
                    </div>
                </div>
                <div id="playhead-gutter"></div>
                <div id="track" data-mega-step="9">
                    <div id="beats"></div>
                    <div id="playhead"></div>
                    <div id="beat-icons"></div>
                    <div id="marquis"></div>
                </div>

                <section id="help">
                    <ul>
                        <li><kbd>R</kbd> - record</li>
                        <li><kbd>Spacebar</kbd> - play</li>
                        <li><kbd>Q</kbd> - quantize (nearest beat)</li>
                        <li><kbd>E</kbd> - edit</li>
                        <li><kbd>X</kbd> - clear track</li>
                    </ul>
                    <div class="close">x</div>
                </section>
            </main>
            <footer>
                <p>vanilla <span class="signature">JavaScript</span></p>
            </footer>

            <!-- Sounds -->
            <audio data-key="65" src="./sounds/clap.wav"></audio>
            <audio data-key="83" src="./sounds/hihat.wav"></audio>
            <audio data-key="68" src="./sounds/kick.wav"></audio>
            <audio data-key="70" src="./sounds/openhat.wav"></audio>
            <audio data-key="71" src="./sounds/boom.wav"></audio>
            <audio data-key="72" src="./sounds/ride.wav"></audio>
            <audio data-key="74" src="./sounds/snare.wav"></audio>
            <audio data-key="75" src="./sounds/tom.wav"></audio>
            <audio data-key="76" src="./sounds/tink.wav"></audio>
            <audio data-key="186" src="./sounds/cowbell.wav"></audio>
            <audio data-key="222" src="./sounds/cowbell_muted.wav"></audio>
            <audio id="tick" src="./sounds/metronone-tick.wav"></audio>
        </div>
        <script src="./drum-machine.js"></script>

        <script src="./mega-walkthrough/mega-walkthrough.js"></script>
        <script>
            megaWalkthrough.setCopy([
                ["Help", "Press '?' to toggle Help."],
                [
                    "Drum Pad",
                    "Each sample corresponds to a key on the keyboard.  Try it out!",
                ],
                [
                    "Beat Light",
                    "Press Spacebar to play.  This light flashes on the beat while the track is playing or recording.",
                ],
                [
                    "Record",
                    "Press 'R' to toggle recording.  Press sample keys while recording to add notes to the track.",
                ],
                ["Cut", "Press 'X' (or backspace) to remove selected notes."],
                [
                    "Quantize",
                    "Press 'Q' to toggle quantize mode, snapping notes to the closest beat.",
                ],
                [
                    "Edit",
                    "Press 'E' to toggle Edit mode.  In edit mode, you can select, move and delete notes.",
                ],
                ["Tempo", "Drag slider to set beats-per-minute."],
                [
                    "Measures",
                    "Drag slider to set number of measures in your track.",
                ],
                [
                    "Track",
                    "Recorded notes are displayed here. Select, move and cut notes while Edit or Record mode are on.",
                ],
                ["Copy Track", "Copy the track code to clipboard."],
                [
                    "Build Track From Code",
                    "Paste code and press 'Enter Code' button.",
                ],
            ]);
            // Change 'steps' to object format:
            /*
    [
        {
            title: "Some Title",
            copy: "Some Copy",
            querySelector: [query selector to target the element],
            eventTrigger: [event to trigger on this element - can be left out]
        },
        {
            title: "Some Title",
            copy: "Some Copy",
            querySelector: [query selector to target the element],
            eventTrigger: [event to trigger on this element - can be left out]
        },
    ]
    */
            // megaWalkthrough.show();
            // setTimeout(() => {
            //     // Give time for Help (?) to get positioned

            // }, 1000);
            megaWalkthrough.start();
            megaWalkthrough.hide();
            window.addEventListener("keydown", (event) => {
                console.log("code: ", event.code);
                if (event.code === "Slash") {
                    // '?'
                    // help
                    megaWalkthrough.toggle();
                } else if (event.code === "Escape") {
                    megaWalkthrough.hide();
                }
            });

            document
                .getElementById("help-icon")
                .addEventListener("pointerdown", (event) => {
                    megaWalkthrough.toggle();
                });
        </script>
    </body>
</html>
